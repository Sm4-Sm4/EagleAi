<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Eagle Terminal</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background: #000; color: #00ff88; font-family: "Source Code Pro", monospace; overflow: hidden; }
#mainContainer { display:flex; width:100vw; height:100vh; }
#sidebar { width:280px; background: linear-gradient(180deg,#111,#0a0a0a); border-right:1px solid #222; padding:16px; display:flex; flex-direction:column; justify-content:space-between; }
#sidebar .btn { width:100%; padding:6px 10px; background:transparent; color:#23D200; border:1px solid #23D200; border-radius:2px; font-weight:bold; text-align:center; cursor:pointer; margin-bottom:6px; font-size:1rem; transition: background 0.2s, color 0.2s; }
#sidebar .btn:hover { background:#00ff88; color:#000; }
#chatContainer { flex:1; display:flex; flex-direction:column; padding:16px; background:#000; border-left:1px solid #222; overflow-y:auto; font-family: "Source Code Pro", monospace; font-size:18px; }
.terminal-line { display:flex; flex-wrap:wrap; width:100%; }
.prompt { color:#23D200; user-select:none; flex-shrink:0; width:140px; font-size:18px; }
.input-wrapper { display:flex; flex-wrap:wrap; white-space:pre-wrap; word-break:break-word; flex:1; font-size:18px; }
.input-text { color:#23D200; }
.cursor { color:#23D200; animation:blink 1s steps(1) infinite; }
@keyframes blink { 50% { opacity:0; } }
.msg-ai, .msg-error { color:#fff; white-space:pre-wrap; word-break:break-word; font-size:18px; display:flex; }
.msg-ai::before, .msg-error::before { content:""; display:inline-block; width:140px; flex-shrink:0; }
.msg-error { color:#f92672; }
</style>
</head>
<body>
<div id="mainContainer">
  <div id="sidebar">
    <div class="flex flex-col">
      <button id="btnProfile" class="btn">Profile</button>
      <button id="btnNewChat" class="btn">New Chat</button>
      <button id="btnReloadTokens" class="btn">Recharger Tokens</button>
      <div id="conversationList"></div>
    </div>
    <a href="https://t.me/+DKNhCjWNY4A2NmQx" target="_blank" class="btn mt-4">Rejoindre Telegram</a>
  </div>
  <div id="chatContainer"></div>
</div>

<script>
// ------------------------------
// PROTECTION + BYPASS "dimitri"
// ------------------------------
const user = localStorage.getItem("user");
if(!user){
  const bypass = prompt("Entrez votre identifiant pour accéder au terminal :");
  if(bypass === "7294"){
    localStorage.setItem("user","bypass-7294");
    alert("Bypass activé");
  } else {
    window.location.href = "./index.html";
  }
}

// ------------------------------
// Redirection boutons
// ------------------------------
document.getElementById("btnProfile").addEventListener("click",()=>{window.location.href="./login.html";});
document.getElementById("btnNewChat").addEventListener("click",()=>{window.location.href="./terminal.html";});

// ------------------------------
// Recharger tokens
// ------------------------------
document.getElementById("btnReloadTokens").addEventListener("click", () => {
  // Ici tu peux ajouter ton appel backend pour créditer les tokens
});

// ------------------------------
// Terminal IA
// ------------------------------
const chatContainer = document.getElementById("chatContainer");
let lastRequestTime = 0;
const COOLDOWN = 1500;

function createInputLine(){
  const line = document.createElement("div");
  line.className="terminal-line";

  const prompt = document.createElement("span");
  prompt.className="prompt";
  prompt.textContent="user@eagle:~$ ";

  const inputWrapper = document.createElement("span");
  inputWrapper.className="input-wrapper";

  const inputText = document.createElement("span");
  inputText.className="input-text";

  const cursor = document.createElement("span");
  cursor.className="cursor";
  cursor.textContent="_";

  inputWrapper.appendChild(inputText);
  inputWrapper.appendChild(cursor);
  line.appendChild(prompt);
  line.appendChild(inputWrapper);
  chatContainer.appendChild(line);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  let inputValue = "";

  document.addEventListener("keydown", function handler(e){
    if(e.key==="Backspace"){
      inputValue = inputValue.slice(0,-1);
      inputText.textContent = inputValue;
      e.preventDefault();
    }
    else if(e.key==="Enter"){
      e.preventDefault();
      const now = Date.now();
      if(now - lastRequestTime < COOLDOWN) return;
      if(!inputValue) return;

      lastRequestTime = now;
      document.removeEventListener("keydown", handler);
      cursor.remove();

      typeAIMessage(inputValue).then(()=>createInputLine());
      inputValue="";
    }
    else if(e.key.length === 1){
      inputValue += e.key;
      inputText.textContent = inputValue;
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
  });
}

async function typeAIMessage(userMsg){
  const div = document.createElement("div");
  div.className = "msg-ai";
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  const thinking = document.createElement("span");
  thinking.textContent = "eagle réfléchit : 0 ms";
  div.appendChild(thinking);

  let startTime = Date.now();
  const interval = setInterval(()=>{
    const elapsed = Date.now()-startTime;
    thinking.textContent = `Reflexion ${elapsed} ms`;
    chatContainer.scrollTop = chatContainer.scrollHeight;
  },50);

  try{
    const response = await fetch("https://lamont-beechy-goodly.ngrok-free.dev/chat", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ message: userMsg })
    });

    const data = await response.json();
    clearInterval(interval);
    thinking.remove();
    div.textContent = data.reply || "...";
  } catch(err){
    clearInterval(interval);
    thinking.remove();
    div.className="msg-error";
    div.textContent="Erreur : impossible de contacter l’IA.";
  }
}

createInputLine();
</script>
  <div id="tokenPopup" class="fixed inset-0 bg-black/75 backdrop-blur-sm flex justify-center items-center z-50 hidden opacity-0 transition-opacity duration-300">
  <div class="bg-[#111] border-2 border-[#23D200] rounded-2xl p-8 w-96 max-w-[90vw] relative shadow-lg transform scale-90 transition-transform duration-300">
    <button id="closePopup" class="absolute top-3 right-3 text-[#23D200] font-bold text-xl hover:text-white transition-colors">✖</button>
    <h2 class="text-3xl font-extrabold text-[#23D200] mb-4 text-center">Recharger vos Tokens</h2>
    <p class="text-gray-400 mb-6 text-center">Choisissez une offre et cliquez sur Acheter pour obtenir plus de tokens.</p>
    <div class="flex flex-col gap-4">
      <button class="btnOffer py-3 font-bold text-lg rounded-lg transition-all duration-300 bg-[#000] border-2 border-[#23D200]" data-tokens="100">100 Tokens - 1,99€</button>
      <div class="relative">
        <span class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#1ed760] text-black px-3 py-1 text-xs font-semibold rounded-full shadow-lg">Populaire</span>
        <button class="btnOffer py-3 font-bold text-lg rounded-lg transition-all duration-300 bg-[#000] border-2 border-[#23D200]" data-tokens="250">250 Tokens - 4,99€</button>
      </div>
      <button class="btnOffer py-3 font-bold text-lg rounded-lg transition-all duration-300 bg-[#000] border-2 border-[#23D200]" data-tokens="500">500 Tokens - 10,99€</button>
    </div>
  </div>
</div>
<script src="./tokenPopup.js"></script>
</body>
</html>









